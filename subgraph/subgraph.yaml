specVersion: 0.0.5
schema:
  file: ./schema.graphql
dataSources:
  # ========================================
  # Story Protocol - IP Asset Registry
  # ========================================
  - kind: ethereum
    name: StoryProtocol
    network: story-testnet # Story Protocol Network
    source:
      address: "0x0000000000000000000000000000000000000000" # Story Protocol IP Registry address
      abi: StoryProtocol
      startBlock: 0 # Update with deployment block
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - IPAsset
        - IPAssetUsage
      abis:
        - name: StoryProtocol
          file: ./abis/StoryProtocol.json
      eventHandlers:
        # Core Handler 1: IP Registration
        - event: IPRegistered(indexed bytes32,indexed address,string,string,string)
          handler: handleIPRegistered
        # IP Usage Tracking for CVS
        - event: IPUsed(indexed bytes32,indexed address,string,uint256)
          handler: handleIPUsed
        - event: IPRemixed(indexed bytes32,indexed bytes32,indexed address)
          handler: handleIPRemixed
      file: ./src/mapping.ts

  # ========================================
  # Atlas ADLV - IP-Backed Lending Vault
  # ========================================
  - kind: ethereum
    name: AtlasADLV
    network: story-testnet
    source:
      address: "0x76d81731e26889Be3718BEB4d43e12C3692753b8" # Atlas ADLV Contract address (deployed)
      abi: AtlasADLV
      startBlock: 0
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - IDOVault
        - DataLicenseSale
        - Loan
        - Deposit
      abis:
        - name: AtlasADLV
          file: ./abis/AtlasADLV.json
      eventHandlers:
        # Vault Creation & CVS Initialization
        - event: VaultCreated(indexed address,indexed bytes32,uint256)
          handler: handleVaultCreated
        # Core Handler 2: License Sale (for CVS calculation)
        - event: LicenseSold(indexed address,indexed bytes32,indexed address,uint256,string)
          handler: handleLicenseSale
        # Core Handler 3: Loan Issuance (based on CVS)
        - event: LoanIssued(indexed address,indexed address,uint256,uint256,uint256,uint256)
          handler: handleLoanIssued
        # CVS Updates
        - event: CVSUpdated(indexed address,uint256,uint256)
          handler: handleCVSUpdated
        # Loan Management
        - event: LoanRepaid(indexed address,indexed address,uint256,uint256)
          handler: handleLoanRepaid
        - event: LoanDefaulted(indexed address,indexed address,uint256)
          handler: handleLoanDefaulted
        # Vault Deposits
        - event: Deposited(indexed address,indexed address,uint256,uint256)
          handler: handleDeposited
        - event: Withdrawn(indexed address,indexed address,uint256,uint256)
          handler: handleWithdrawn
      file: ./src/mapping.ts

  # ========================================
  # IDO Contract
  # ========================================
  - kind: ethereum
    name: IDOContract
    network: story-testnet
    source:
      address: "0xB176c1FA7B3feC56cB23681B6E447A7AE60C5254" # IDO Contract address (deployed on Story Protocol Testnet)
      abi: IDOContract
      startBlock: 0
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - IDOPool
        - IDOParticipation
      abis:
        - name: IDOContract
          file: ./abis/IDOContract.json
      eventHandlers:
        - event: PoolCreated(indexed bytes32,address,uint256,uint256,uint256)
          handler: handlePoolCreated
        - event: Participated(indexed bytes32,indexed address,uint256)
          handler: handleParticipated
        - event: TokensClaimed(indexed bytes32,indexed address,uint256)
          handler: handleTokensClaimed
      file: ./src/mapping.ts

  # ========================================
  # Bridge Contract
  # ========================================
  - kind: ethereum
    name: BridgeContract
    network: mainnet
    source:
      address: "0x0000000000000000000000000000000000000000" # Update with deployed address
      abi: BridgeContract
      startBlock: 0
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - BridgeTransaction
      abis:
        - name: BridgeContract
          file: ./abis/BridgeContract.json
      eventHandlers:
        - event: BridgeInitiated(indexed bytes32,uint256,uint256,address,address,uint256)
          handler: handleBridgeInitiated
        - event: BridgeCompleted(indexed bytes32)
          handler: handleBridgeCompleted
      file: ./src/mapping.ts

  # ========================================
  # World ID Verifier Contract
  # ========================================
  - kind: ethereum
    name: WorldIDVerifier
    network: mainnet
    source:
      address: "0x0000000000000000000000000000000000000000" # Update with deployed address
      abi: WorldIDVerifier
      startBlock: 0
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - WorldIDVerification
      abis:
        - name: WorldIDVerifier
          file: ./abis/WorldIDVerifier.json
      eventHandlers:
        - event: Verified(indexed address,string,string)
          handler: handleVerified
      file: ./src/mapping.ts

